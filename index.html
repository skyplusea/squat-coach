<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI ìŠ¤ì¿¼íŠ¸ ì½”ì¹˜</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
    }

    .container {
        width: 100%;
        max-width: 640px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        text-align: center;
    }

    .header h1 {
        font-size: 24px;
        margin-bottom: 5px;
    }

    .header p {
        font-size: 14px;
        opacity: 0.9;
    }

    .video-container {
        position: relative;
        width: 100%;
        background: #000;
    }

    #video {
        width: 100%;
        height: auto;
        display: none;
    }

    #canvas {
        width: 100%;
        height: auto;
        display: block;
    }

    .controls {
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .btn {
        padding: 15px 30px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
        background: #f0f0f0;
        color: #333;
    }

    .stats {
        padding: 20px;
        background: #f8f9fa;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    .stat-card {
        background: white;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 14px;
        color: #666;
    }

    .feedback {
        padding: 15px 20px;
        margin: 0 20px 20px;
        border-radius: 10px;
        font-weight: 500;
        text-align: center;
        transition: all 0.3s;
    }

    .feedback.good {
        background: #d4edda;
        color: #155724;
        border: 2px solid #c3e6cb;
    }

    .feedback.warning {
        background: #fff3cd;
        color: #856404;
        border: 2px solid #ffeaa7;
    }

    .feedback.error {
        background: #f8d7da;
        color: #721c24;
        border: 2px solid #f5c6cb;
    }

    .status {
        padding: 10px 20px;
        text-align: center;
        font-size: 14px;
        color: #666;
    }

    .camera-switch {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255,255,255,0.9);
        border: none;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        font-size: 20px;
        cursor: pointer;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    @media (max-width: 480px) {
        .header h1 {
            font-size: 20px;
        }
       
        .stat-value {
            font-size: 24px;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‹ï¸ AI ìŠ¤ì¿¼íŠ¸ ì½”ì¹˜</h1>
            <p>ì¹´ë©”ë¼ ì•ì—ì„œ ìŠ¤ì¿¼íŠ¸ë¥¼ í•´ë³´ì„¸ìš”!</p>
        </div>

```
    <div class="status" id="status">ì¹´ë©”ë¼ ì¤€ë¹„ ì¤‘...</div>

    <div class="video-container">
        <video id="video" playsinline></video>
        <canvas id="canvas"></canvas>
        <button class="camera-switch" id="cameraSwitch" style="display: none;">ğŸ”„</button>
    </div>

    <div class="feedback" id="feedback" style="display: none;">
        ìì„¸ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...
    </div>

    <div class="stats">
        <div class="stat-card">
            <div class="stat-value" id="count">0</div>
            <div class="stat-label">ìŠ¤ì¿¼íŠ¸ íšŸìˆ˜</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="angle">-</div>
            <div class="stat-label">ë¬´ë¦ ê°ë„</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-primary" id="startBtn">ì‹œì‘í•˜ê¸°</button>
        <button class="btn btn-secondary" id="resetBtn" style="display: none;">ì´ˆê¸°í™”</button>
    </div>
</div>

<script>
    // ì „ì—­ ë³€ìˆ˜
    let camera = null;
    let pose = null;
    let isRunning = false;
    let squatCount = 0;
    let isSquatting = false;
    let lastKneeAngle = 180;
    let useFrontCamera = true;

    // DOM ìš”ì†Œ
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const status = document.getElementById('status');
    const feedback = document.getElementById('feedback');
    const countEl = document.getElementById('count');
    const angleEl = document.getElementById('angle');
    const cameraSwitchBtn = document.getElementById('cameraSwitch');

    // ê°ë„ ê³„ì‚° í•¨ìˆ˜
    function calculateAngle(a, b, c) {
        const radians = Math.atan2(c.y - b.y, c.x - b.x) - Math.atan2(a.y - b.y, a.x - b.x);
        let angle = Math.abs(radians * 180.0 / Math.PI);
        if (angle > 180.0) {
            angle = 360 - angle;
        }
        return angle;
    }

    // í¬ì¦ˆ ë¶„ì„ í•¨ìˆ˜
    function analyzePose(landmarks) {
        // ì™¼ìª½ ë‹¤ë¦¬ ëœë“œë§ˆí¬ (hip, knee, ankle)
        const leftHip = landmarks[23];
        const leftKnee = landmarks[25];
        const leftAnkle = landmarks[27];

        // ì˜¤ë¥¸ìª½ ë‹¤ë¦¬ ëœë“œë§ˆí¬
        const rightHip = landmarks[24];
        const rightKnee = landmarks[26];
        const rightAnkle = landmarks[28];

        // ì–‘ìª½ ë¬´ë¦ ê°ë„ ê³„ì‚°
        const leftKneeAngle = calculateAngle(leftHip, leftKnee, leftAnkle);
        const rightKneeAngle = calculateAngle(rightHip, rightKnee, rightAnkle);
       
        // í‰ê·  ë¬´ë¦ ê°ë„
        const avgKneeAngle = (leftKneeAngle + rightKneeAngle) / 2;
        angleEl.textContent = Math.round(avgKneeAngle) + 'Â°';

        // ìŠ¤ì¿¼íŠ¸ ì¹´ìš´íŒ… ë¡œì§
        const squatThreshold = 100; // ìŠ¤ì¿¼íŠ¸ íŒì • ê°ë„
        const standThreshold = 160; // ì¼ì–´ì„  ìƒíƒœ íŒì • ê°ë„

        let feedbackText = '';
        let feedbackClass = '';

        if (avgKneeAngle < squatThreshold && !isSquatting) {
            // ìŠ¤ì¿¼íŠ¸ ìì„¸ë¡œ ë‚´ë ¤ê°
            isSquatting = true;
           
            // ìì„¸ í‰ê°€
            if (avgKneeAngle < 70) {
                feedbackText = 'âš ï¸ ë„ˆë¬´ ê¹Šê²Œ ì•‰ì•˜ì–´ìš”!';
                feedbackClass = 'warning';
            } else if (avgKneeAngle > 90) {
                feedbackText = 'ğŸ’ª ì¡°ê¸ˆ ë” ê¹Šê²Œ ì•‰ì•„ë³´ì„¸ìš”!';
                feedbackClass = 'warning';
            } else {
                feedbackText = 'âœ… ì™„ë²½í•œ ìì„¸ì˜ˆìš”!';
                feedbackClass = 'good';
            }
        } else if (avgKneeAngle > standThreshold && isSquatting) {
            // ë‹¤ì‹œ ì¼ì–´ë‚¨ - ìŠ¤ì¿¼íŠ¸ 1íšŒ ì™„ë£Œ
            isSquatting = false;
            squatCount++;
            countEl.textContent = squatCount;
            feedbackText = 'ğŸ‰ ìŠ¤ì¿¼íŠ¸ 1íšŒ ì™„ë£Œ!';
            feedbackClass = 'good';
        } else if (!isSquatting && avgKneeAngle > standThreshold) {
            feedbackText = 'ì¤€ë¹„ ìì„¸ - ìŠ¤ì¿¼íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”!';
            feedbackClass = 'good';
        }

        lastKneeAngle = avgKneeAngle;

        // í”¼ë“œë°± í‘œì‹œ
        if (feedbackText) {
            feedback.textContent = feedbackText;
            feedback.className = 'feedback ' + feedbackClass;
            feedback.style.display = 'block';
        }
    }

    // í¬ì¦ˆ ê²°ê³¼ ì²˜ë¦¬
    function onResults(results) {
        if (!isRunning) return;

        // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // ë¹„ë””ì˜¤ í”„ë ˆì„ ê·¸ë¦¬ê¸°
        ctx.save();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);

        // í¬ì¦ˆ ëœë“œë§ˆí¬ ê·¸ë¦¬ê¸°
        if (results.poseLandmarks) {
            // ì—°ê²°ì„  ê·¸ë¦¬ê¸°
            window.drawConnectors(ctx, results.poseLandmarks, window.POSE_CONNECTIONS,
                {color: '#00FF00', lineWidth: 4});
            // ê´€ì ˆì  ê·¸ë¦¬ê¸°
            window.drawLandmarks(ctx, results.poseLandmarks,
                {color: '#FF0000', lineWidth: 2, radius: 6});

            // ìì„¸ ë¶„ì„
            analyzePose(results.poseLandmarks);
        }

        ctx.restore();
    }

    // MediaPipe Pose ì´ˆê¸°í™”
    async function initPose() {
        pose = new Pose({
            locateFile: (file) => {
                return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
            }
        });

        pose.setOptions({
            modelComplexity: 1,
            smoothLandmarks: true,
            enableSegmentation: false,
            smoothSegmentation: false,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        pose.onResults(onResults);
    }

    // ì¹´ë©”ë¼ ì‹œì‘
    async function startCamera() {
        try {
            const constraints = {
                video: {
                    facingMode: useFrontCamera ? 'user' : 'environment',
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }
            };

            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            video.srcObject = stream;
           
            await video.play();

            camera = new window.Camera(video, {
                onFrame: async () => {
                    if (isRunning) {
                        await pose.send({image: video});
                    }
                },
                width: 1280,
                height: 720
            });

            await camera.start();
           
            status.textContent = 'ì¤€ë¹„ ì™„ë£Œ! ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
            startBtn.textContent = 'ìš´ë™ ì‹œì‘';
            startBtn.disabled = false;
            cameraSwitchBtn.style.display = 'flex';
           
        } catch (error) {
            console.error('ì¹´ë©”ë¼ ì ‘ê·¼ ì˜¤ë¥˜:', error);
            status.textContent = 'ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
        }
    }

    // ì¹´ë©”ë¼ ì „í™˜
    async function switchCamera() {
        useFrontCamera = !useFrontCamera;
       
        // ê¸°ì¡´ ì¹´ë©”ë¼ ì •ì§€
        if (camera) {
            camera.stop();
        }
        if (video.srcObject) {
            video.srcObject.getTracks().forEach(track => track.stop());
        }

        // ìƒˆ ì¹´ë©”ë¼ ì‹œì‘
        await startCamera();
       
        if (isRunning) {
            // ìš´ë™ ì¤‘ì´ì—ˆë‹¤ë©´ ê³„ì† ì§„í–‰
            isRunning = true;
        }
    }

    // ì‹œì‘/ì¤‘ì§€ í† ê¸€
    function toggleStart() {
        isRunning = !isRunning;
       
        if (isRunning) {
            startBtn.textContent = 'ì¼ì‹œì •ì§€';
            startBtn.classList.remove('btn-primary');
            startBtn.classList.add('btn-secondary');
            resetBtn.style.display = 'block';
            status.textContent = 'ìš´ë™ ì¤‘...';
        } else {
            startBtn.textContent = 'ì¬ê°œí•˜ê¸°';
            startBtn.classList.add('btn-primary');
            startBtn.classList.remove('btn-secondary');
            status.textContent = 'ì¼ì‹œì •ì§€ë¨';
        }
    }

    // ì´ˆê¸°í™”
    function reset() {
        squatCount = 0;
        isSquatting = false;
        countEl.textContent = '0';
        angleEl.textContent = '-';
        feedback.style.display = 'none';
       
        if (isRunning) {
            toggleStart();
        }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    startBtn.addEventListener('click', toggleStart);
    resetBtn.addEventListener('click', reset);
    cameraSwitchBtn.addEventListener('click', switchCamera);

    // ì´ˆê¸°í™”
    async function init() {
        await initPose();
        await startCamera();
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    window.addEventListener('load', init);
</script>
```

</body>
</html>